<!-- src/app/shared/entities/exam/exam-list/exam-list.component.html -->
<app-loading-overlay [show]="loading"></app-loading-overlay>

<!-- Page Header -->
<div class="flex justify-between items-center mb-6">
  <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-2">
    Exams
  </h2>

  <button *ngIf="(role$ | async) === RoleType.Admin" (click)="openModal('add')"
    class="inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700">
    <i class="fas fa-plus"></i>
    Add Exam
  </button>
</div>

<!-- Search -->
<div class="mb-6 w-full relative">
  <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
  <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="triggerSearch()" placeholder="Search by Exam Name"
    class="w-full pl-10 pr-10 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
  <button *ngIf="searchTerm" (click)="clearSearch()"
    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-red-500">
    <i class="fas fa-times-circle"></i>
  </button>
</div>

<!-- Bulk Actions -->
<div *ngIf="(role$ | async) === RoleType.Admin && selectedIds.length" class="mb-4 flex justify-between items-center">
  <span class="text-sm text-gray-600">Selected: {{ selectedIds.length }}</span>
  <button (click)="bulkDeleteSelected()" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700">
    Delete Selected
  </button>
</div>

<!-- Exams Table -->
<div class="overflow-x-auto bg-white rounded shadow">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-3">
          <input type="checkbox" [checked]="allSelected" (change)="toggleSelectAll($event)" />
        </th>
        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Name</th>
        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Date</th>

        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Actions</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <tr *ngFor="let exam of filteredExams" class="hover:bg-gray-50 transition">
        <td class="px-4 py-3">
          <input type="checkbox" [(ngModel)]="exam.selected" />
        </td>
        <td class="px-4 py-3">{{ exam.name }}</td>
        <td class="px-4 py-3">{{ exam.date | date: 'mediumDate' }}</td>

        <td class="px-4 py-3 flex gap-3">
          <ng-container *ngIf="(role$ | async) === RoleType.Admin">
            <button (click)="openModal('view', exam)"
              class="text-green-600 hover:text-green-800 flex items-center gap-1">
              <i class="fas fa-eye"></i>
            </button>
            <button (click)="openModal('edit', exam)"
              class="text-yellow-600 hover:text-yellow-800 flex items-center gap-1">
              <i class="fas fa-edit"></i>
            </button>
            <button (click)="deleteExam(exam.id!)" class="text-red-600 hover:text-red-800 flex items-center gap-1">
              <i class="fas fa-trash-alt"></i>
            </button>
          </ng-container>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Add/Edit Modal -->
<div *ngIf="modalMode && modalMode !== 'view'"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md relative">
    <h3 class="text-2xl font-bold mb-6 text-gray-800">
      {{ modalMode === 'add' ? 'Add Exam' : 'Edit Exam' }}
    </h3>

    <div class="mb-4">
      <label class="block mb-2 text-gray-700">Name</label>
      <input *ngIf="selectedExam" [(ngModel)]="selectedExam.name"
        class="border border-gray-300 rounded px-3 py-2 w-full focus:ring focus:ring-blue-100" />
    </div>

    <div class="mb-6">
      <label class="block mb-2 text-gray-700">Date</label>
      <input *ngIf="selectedExam" type="date" [(ngModel)]="selectedExam.date"
        class="border border-gray-300 rounded px-3 py-2 w-full focus:ring focus:ring-blue-100" />
    </div>

    <div class="flex justify-end gap-2">
      <button (click)="closeModal()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300">
        Cancel
      </button>
      <button (click)="saveExam()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        Save
      </button>
    </div>
  </div>
</div>

<!-- View Exam Modal -->
<div *ngIf="modalMode === 'view'" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md relative">
    <h3 class="text-2xl font-bold mb-6 text-gray-800">View Exam Details</h3>

    <div class="mb-4">
      <label class="block mb-1 text-gray-700 font-medium">Name</label>
      <div class="text-gray-800">{{ selectedExam?.name }}</div>
    </div>

    <div class="mb-4">
      <label class="block mb-1 text-gray-700 font-medium">Date</label>
      <div class="text-gray-800">{{ selectedExam?.date | date: 'mediumDate' }}</div>
    </div>


    <div class="flex justify-end">
      <button (click)="closeModal()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300">
        Close
      </button>
    </div>
  </div>
</div>